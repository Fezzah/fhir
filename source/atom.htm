<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Atom Feeds - FHIR v<%version%></title>
    <link rel="Stylesheet" href="fhir.css" type="text/css"/>
    <link rel="Stylesheet" href="fhir-print.css" type="text/css" media="print" />
</head>

<body>
<%sidebar%>


<%maindiv%>
<%atomheader%>


<a name="bundle"></a> <!-- here in case we want to move the specific reference to a bundle further down -->
<h1>Atom Feeds</h1>
<p>
One common operation performed with resources is to gather a collection of resources into a single XML instance.
In FHIR this is referred to as "bundling" the resources together. The resource bundle is not just a list of 
references to resources, but includes their whole content. These resource bundles are useful for a variety of 
different reasons, including:
</p>
<ul>
  <li>Returning a set of resources that meet some criteria as part of a server operation</li>
  <li>Returning a set of versions of resources as part of the history operation on a server</li>
  <li>Storing a collection of resources</li>
  <li>Exchanging a set of resources as part of a message transaction</li>
  <li>Grouping a self-contained set of resources to act as an exchangeable and persistable group with clinical integrity (i.e. a clinical document)</li>
</ul>
<p>
Whenever resources are gathered into a collection, this is done using the Atom format (<a href="http://tools.ietf.org/html/rfc4287" target="_blank">http://tools.ietf.org/html/rfc4287</a>), following this template:
</p>
<pre class="spec">
&lt;feed xmlns="http://www.w3.org/2005/Atom">
  &lt;title&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span> <span style="color:darkgreen;"><a href="datatypes.htm#string">string</a></span> <span style="color:navy;">Text statement of purpose</span><span style="color: Gray"> --&gt;</span>&lt;/title&gt;
  &lt;updated&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span> <span style="color:darkgreen;"><a href="datatypes.htm#instant">instant</a></span> <span style="color:navy;">When the bundle was built</span><span style="color: Gray"> --&gt;</span>&lt;/updated&gt;
  &lt;<u>id</u>&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span> <span style="color:darkgreen;"><a href="datatypes.htm#uri">uri</a></span> <span style="color:navy;">Unique uri for this bundle</span><span style="color: Gray"> --&gt;</span>&lt;/id&gt;
  &lt;link rel="self" href="<span style="color:navy;">[building application url]</span>"&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;">0..1</span><span style="color: Gray"> --&gt;</span>&lt;/link&gt;

  &lt;<u>entry</u>&gt;<span style="color:Gray;">&lt;!-- Zero+ --&gt;</span>
    &lt;title&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span> <span style="color:darkgreen;"><a href="datatypes.htm#string">string</a></span> <span style="color:navy;">Text summary of resource</span><span style="color: Gray"> --&gt;</span>&lt;/title&gt;
    &lt;<u>link</u> rel="self" href="<span style="color:navy;">Version Specific reference to Resource</span>"&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;">0..1</span><span style="color: Gray"> --&gt;</span>&lt;/link&gt;
    &lt;<u>id</u>&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span> <span style="color:darkgreen;"><a href="datatypes.htm#uri">uri</a></span> <span style="color:navy;">Logical Id (uri) for this resource</span><span style="color: Gray"> --&gt;</span>&lt;/id&gt;
    &lt;updated&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span> <span style="color:darkgreen;"><a href="datatypes.htm#instant">instant</a></span> <span style="color:navy;">Last Updated for resource</span><span style="color: Gray"> --&gt;</span>&lt;/updated&gt;
    &lt;published&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;">0..1</span> <span style="color:darkgreen;"><a href="datatypes.htm#instant">instant</a></span> <span style="color:navy;">Time resource copied into the feed</span><span style="color: Gray"> --&gt;</span>&lt;/published&gt;
    &lt;author&gt;<span style="color:Gray;">&lt;!-- Who created resource? --&gt;</span>
      &lt;name&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span> <span style="color:darkgreen;"><a href="datatypes.htm#string">string</a></span> <span style="color:navy;">Name of Human or Device that authored the resource</span><span style="color: Gray"> --&gt;</span>&lt;/name&gt;
      &lt;uri&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;">0..1</span> <span style="color:darkgreen;"><a href="datatypes.htm#uri">uri</a></span> <span style="color:navy;">Link to the resource for the author</span><span style="color: Gray"> --&gt;</span>&lt;/uri&gt;
    &lt;/author>
    &lt;category term="<span style="color:navy;">[Resource Type]</span>" scheme="http://hl7.org/fhir/resource-types"&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span><span style="color: Gray"> --&gt;</span>&lt;/category&gt;  
    &lt;<u>content</u> type="text/xml"&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span><span style="color: Gray"> --&gt;</span>
      &lt;<span style="color:navy;">[ResourceName]</span> xmlns="http://hl7.org/fhir">
        <span style="color: Gray">&lt;!-- </span><span style="color: navy">Content for the resource</span><span style="color: Gray"> --&gt;</span>
      &lt;/<span style="color:navy;">[ResourceName]</span>>
    &lt;/content>
    &lt;summary type="xhtml"&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;">0..1</span><span style="color: Gray"> --&gt;</span>
      &lt;div xmlns="http://www.w3.org/1999/xhtml"><span style="color:Gray;">&lt;!-- </span><span style="color:navy;">Narrative from resource</span><span style="color:Gray;"> --&gt;</span>&lt;/div>
    &lt;/summary>
  &lt;/entry&gt;
  &lt;Signature xmlns="http://www.w3.org/2000/09/xmldsig#"&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;">0..1</span><span style="color: Gray"> --&gt;</span>
    <span style="color:Gray;">&lt;!-- </span><span style="color:navy;">Enveloped Digital Signature (see Atom section 5.1)</span><span style="color:Gray;"> --&gt;</span>
  &lt;/Signature&gt;
&lt;/feed&gt;
</pre>
<h2>Notes</h2>
<ul>
 <li>Logically, a bundle is a set of resources that are prepared to send somewhere for consumption - a "feed". There is no implication that the feed is a standing arrangement (though this is not precluded)</li>
 <li>The order of elements does not matter in an atom feed. The order of elements in the atom namespace as documented here does not need to be followed</li>
 <li>The title for the feed and the entry are arbitrary human readable content and not to be used for any automated processing. Applications may populate these in any useful way</li> 
 <li>Every bundle must have a unique id and that id must be a valid absolute <a href="datatypes.htm#uri">uri</a>. UUIDs are recommended (urn:uuid:...)</li>
 <li>The feed.link element is assigned no particular meaning the FHIR specification, but may be used to provide a reference to the source of the feed</li>
 <li>The entry element carries the <a href="xml.htm#metadata">three pieces of resource metadata</a>: Id (.id), Version Id (.link), Last Updated (.updated)</li>
 <li>The entry.id must be an absolute url, the tail element of which is the logical id of the resource</li>
 <li>The entry.link is a version specific reference to the resource. It must be present unless the resource has no established identity (see comments under <a href="http.htm#batch">RESTful batch Operation</a>).</li>
 <li>When used in a <a href="http.htm">RESTful implementation</a>, the entry.link and entry.id are the URLs of the resource on the system; the version specific link can be used as the basis synchronizing pub/sub systems using the atom bundle with the <a href="http.htm#updates">updates operation</a>. In other contexts, the values should be literal references to a server if one is available</li>
 <li>Author is a required element by the atom element. The author of a resource is not explicit in the FHIR resource model; instead it is delegated to the infrastructure. The name is the name of a human author or a device. The uri is a link to the resource for the author</li>
 <li>An xml:base element may be specified on the content element, though one is not needed for FHIR resources.</li>
 <li>The entire bundle can be signed with a single Enveloped Digital Signature as described in the Atom specification (section 5.1). See below for further comment</li>
</ul>

<h2>Bundling versions - deletion</h2>
<p>
When returning a set of resources or versions of a resource, an entry might indicate that the entry has been <i>deleted</i>. Deleted resources are represented
in an atom feed as defined by <a href="http://www.rfc-editor.org/rfc/rfc6721.txt">rfc6721.txt</a>: 
</p>
<pre class="spec">
&lt;feed xmlns="http://www.w3.org/2005/Atom">
  <span style="color:Gray;">... feed elements and other entries ...</span>
  &lt;at:deleted-entry xmlns:at="http://purl.org/atompub/tombstones/1.0"
      ref="<span style="color:navy;">[Logical Id for deleted resource]</span>" when="<span style="color:navy;"><span style="color:darkgreen;"><a href="datatypes.htm#instant">instant</a></span> [when deleted]</span>"&gt;
    &lt;link rel="self" href="<span style="color:navy;">[Version Specific reference to Resource]</span>"&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;">0..1</span><span style="color:Gray;"> --&gt;</span>&lt;/link&gt;
  &lt;/at:deleted-entry>
  <span style="color:Gray;">... other entries ...</span>
</pre>
<p>
A deleted resource returns a 410 error if it is accessed through the RESTful interface. 
</p>
<a name="Binary"> </a>
<h2>Binary Resources</h2>
<p>
There are situations where it is useful or required to represent binary resources in the bundle. These are resources that are referred to from FHIR Resources (usually via a URI)
where it is convenient to include these in the feed directly rather than leaving them by reference.
</p>
<p>
When binary resources are represented in the feed, they are enclosed as base64 encoded content along with a content-type, which is the mime-type as it would be specified in HTTP:
</p>
<pre class="spec">
  <span style="color:Gray;">...</span>
  &lt;entry&gt;
    ...
    &lt;category term="Binary" scheme="http://hl7.org/fhir/resource-types"&gt;<span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span><span style="color:Gray;"> --&gt;</span>&lt;/category&gt;
    &lt;<u>content</u> type="text/xml"><span style="color:Gray;">&lt;!-- </span><span style="color: brown;"><b>1..1</b></span><span style="color:Gray;"> --&gt;</span>
      &lt;Binary xmlns="http://hl7.org/fhir" contentType="<span style="color:navy;">[mime type]</span>"&gt;<span style="color:navy;">[Base64 Content]</span>&lt;/Binary&gt;
    &lt;/content>
    &lt;summary type="xhtml"><span style="color:Gray;">&lt;!-- </span><span style="color: brown;">0..1</span><span style="color:Gray;"> --&gt;</span>
      &lt;div xmlns="http://www.w3.org/1999/xhtml">Binary resource&lt;/div>
    &lt;/summary>
  &lt;/entry&gt;
  <span style="color:Gray;">...</span>
</pre>
<p>
The summary should be some equivalent to "Binary Resource" in an appropriate language.
</p>


<h2>Resolving references to Resources</h2>
<p>
Readers of the resources bundles should always look through the resources in the 
atom feed when a <a href="xml.htm#Resource">resource reference</a> is encountered. 
The resource reference may have the resource type and a relative url, 
which is the id of the target, like this:
</p>
<div class="example">
<pre class="xml">
  &lt;institution&gt;
    &lt;type&gt;Organization&lt;/type&gt;
    &lt;id&gt;23&lt;/id&gt;
  &lt;/institution&gt;
</pre>
</div>
<p>
A reader trying to find the resource this <i>institution</i> element identifies 
should always look through the entries in the atom feed prior to looking 
anywhere else for the institution. If that organization is in the feed, 
it would look like this:
</p>
<div class="example">
<pre class="xml">
   .. feed ..
  &lt;entry>
    .. 
    &lt;id>http://acme.com/fhir/organization/@23&lt;id>
    .. 
    &lt;category term="Organization" scheme="http://hl7.org/fhir/resource-types"/>

    &lt;content type="text/xml">
      &lt;Organization xmlns="http://hl7.org/fhir">
         &lt;!-- other Content for the resource --&gt;
      &lt;/Organization>
    &lt;/content>
  ... feed ...
</pre>
</div>
<p>
It would also be possible to locate the resource by an absolute url. In this case, 
the <i>id</i> element contains a reference to the location of the resource:
</p>
<div class="example">
<pre class="xml">
  &lt;institution&gt;
    &lt;type&gt;Organization&lt;/type&gt;
    &lt;id&gt;http://acme.com/fhir/organization/@23&lt;/id&gt;
  &lt;/institution&gt;
</pre>
</div>

<p>
If there is no resource in the atom feed with an appropriate URL, then 
the application may try accessing the provided URL directly or use some 
other implementation-specific method for resolving how to find the resource.
Note that this example used a <a href="http.htm">FHIR RESTful URL</a>, but this 
is not required.
</p>
<h2>Implementation Notes</h2>
<a name="digsig"></a>
<ul>
<li>Atom Feeds may be signed following the rules described in the Atom specification. One consequence of 
signing the document is that URLs, Identifiers and internal references are frozen and cannot be changed.
This might be a desired feature, but it may also cripple interoperability between closed eco-systems where
<a href="implementation.htm#identity">re-identification</a> frequently occurs. For this reason, it is recommended that only Document Bundles
are signed and then only when all the related resources are found in the bundle.</li>
<li>
<a name="Ids"></a>
FHIR resources make use of id attributes as targets for <a href="xml.htm#idref">internal references with resources</a>. 
These id attributes are unique and resolved within the context of a single resource. When resources are 
combined into a bundle, different resources may contain duplicate id attributes. Thus it is important to limit
the scope of resolution of an id attribute to the resource in which the <i>id</i> attribute is declared.
</li>
<li><a name="json"></a>
When representing the atom feed as JSON, use the method described <a href="json.htm">here</a>.</li>
<li><a name="rest"></a>The <a href="document.htm#rest">Document</a> framework defines an additional RESTful end-point that works like a <a href="http.htm">normal RESTful interface</a> but serves document bundles instead of document resources.</li>
</ul>

<%footer%>
<%/maindiv%>
</body>
</html>