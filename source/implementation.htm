<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Implementation Details</title>
    <link rel="Stylesheet" href="test.css" type="text/css" media="screen" />
</head>

<body>
<%header%>
<%sidebar%>


<%maindiv%>

<h1>Implementation Details</h1>

<p>
While the FHIR Resources are designed with a simple <a href="http.htm">RESTful HTTP-based implementation</a> 
in mind, it is not necessary to use this implementation framework. This specification also defines a 
straight <a href="messaging.htm">messaging based implementation framework</a> for FHIR resources, and a <a href="documents.htm">document-based framework</a>, 
as well as documenting how <a href="hdata.htm">FHIR resources are used with hData</a>.
</p>
<a name="SOA"></a>
<h3>SOA</h3>
<p>
Alternatively, it is not necessary to use any of these approaches; resources can be exchanged or persisted
using any technical means that is appropriate to the context at hand. A common use of FHIR 
resources or aggregations is as parameters of service interfaces. FHIR itself does not define
any particular service interface; instead, other standards and implementations define their 
own service interfaces and architecture that use FHIR resources. As long as the resources that
are used are conformant with regard to this specification, and the rules for authoring and
reading applications are followed, then the implementation can claim conformance to
"FHIR Resources". Such implementations will need to resolve several issues:
</p>
<ul>
  <li>Resource references need to be able to be resolved. There are a variety of solutions to this, from ensuring that the all the relevant resources are aggregated together, or that all relevent resources are passed as parameters in a service call, through to a resource repository that provides access to all reference resources. </li>
  <li>The <a href="xml.htm#metadata">Resource metadata</a> items "Version Id" and "Last Modified Date" are provided for use in resolving resource versioning and concurrency issues, both from a technical and human perspective. Most contexts of use will require at least one if not both of these attributes for some uses, and the implementation framework will need to resolve how and when they are exchanged</li>
  <li>The <a href="xml.htm#metadata">resource metadata</a> item "Master Location" may be useful as part of a solution towards resolving resource references, and/or handling issues pertaining to distrubed use and re-use of resources, and implementations should describe how this data item is handlded</li>
  <li>The <a href="constraint.htm">basic conformance statement</a> allows authoring and reading applications to describe their rules concerning the contents of a resource. 
      The implementation will need to describe how this constraint statement fits into the exchange/persistence context.</li>
  <li>How transactional information such as data enterer, author(s), responsible party, consent, and approvals is treated</li>
</ul>
<p>
The resolution to these issues should be documented and published somewhere.
</p>

<a name="Use"></a>
<h2>Using Resources</h2>
<p>
Given these options, there are many ways to implement any particular workflow. 
There are many ways to use resources to build working systems:
</p>
<ul>
<li>A RESTful paradigm where resources are exchanged separately using http transactions directly as defined in this specification. Implementations can use both push and pull, or a mix of the two</li>
<li>The resources can be exchanged in messages or some other SOA implementation, where the resources are directly the contents/parameters that are exchanged</li>
<li>The resources can be "aggregated" into documents that are self-contained and complete collections of linked resources, and then these documents can be exchanged and/or persisted</li>
<li>The resources can be embedded in HTML pages or other web content such as content feeds</li>
</ul>



<a name="Aggregation"/></a>
<h2>Aggregation</h2>
<p>
One basic operation performed with resources is to aggregate a group of resources into a single XML document. 
This is performed in many of the implementation frameworks.
Aggregated resources are useful for grouping resources together for a variety of different reasons, including:
</p>
<ul>
  <li>Listing a set of resources that have changed since a given instant in time </li>
  <li>Exchanging a set of resources as a single batch</li>
  <li>Grouping a self contained set of resources to act as an exchangeable and persistable group with clinical integrity (i.e. a clinical document)</li>
</ul>
<p>
Resources are aggregated using the Atom format (<a href="http://tools.ietf.org/html/rfc4287" target="_blank">http://tools.ietf.org/html/rfc4287</a>), following this template:
</p>
<pre>
&lt;<b>feed</b> xmlns="http://www.w3.org/2005/Atom" xmlns:gd="http://schemas.google.com/g/2005">
  &lt;<b>title</b> <a href="xml.htm#Control" class="cf">mand</a> <font color="darkgreen">type="<a href="datatypes.htm#string">string</a>"</font>&gt;<font color="navy">text statement of purpose</font>&lt;/title&gt;
  &lt;<b>updated</b> <a href="xml.htm#Control" class="cf">mand</a> <font color="darkgreen">type="<a href="datatypes.htm#dateTime">dateTime</a>"</font>&gt;<font color="navy">when aggregation happened</font>&lt;/updated&gt;
  &lt;<b>id</b> <a href="xml.htm#Control" class="cf">mand</a> <font color="darkgreen">type="<a href="datatypes.htm#id">id</a>"</font>&gt;<font color="navy">unique id for this aggregation</font>&lt;/id&gt;
  &lt;<b>link</b> <a href="xml.htm#Control" class="cf">mand</a> rel="via" href="<font color="navy">aggregating application url</font>"/&gt;

  &lt;<b>entry</b> gd:etag="<font color="navy">version id</font>"&gt;    <font color="Gray">&lt;!-- One+ --&gt;</font>
    &lt;<b>title</b> <a href="xml.htm#Control" class="cf">mand</a> <font color="darkgreen">type="<a href="datatypes.htm#string">string</a>"</font>&gt;<font color="navy">text summary of resource</font>&lt;/title&gt;
    &lt;<b>link</b> <a href="xml.htm#Control" class="cf">mand</a> rel="self" href="<font color="navy">Master Location for Resource</font>"/&gt;
    &lt;<b>id</b> <a href="xml.htm#Control" class="cf">mand</a> <font color="darkgreen">type="<a href="datatypes.htm#id">id</a>"</font>&gt;<font color="navy">Master Id for this resource</font>&lt;/id&gt;
    &lt;<b>updated</b> <a href="xml.htm#Control" class="cf">mand</a> <font color="darkgreen">type="<a href="datatypes.htm#dateTime">dateTime</a>"</font>&gt;<font color="navy">Last Updated for resource</font>&lt;/updated&gt;
    &lt;<b>published</b> <a href="xml.htm#Control" class="cf">opt</a> <font color="darkgreen">type="<a href="datatypes.htm#dateTime">dateTime</a>"</font>&gt;<font color="navy">Time resource sourced for aggregation</font>&lt;/updated&gt;
    &lt;<b>author</b>&gt;
      &lt;<b>name</b> <a href="xml.htm#Control" class="cf">mand</a> <font color="darkgreen">type="<a href="datatypes.htm#string">string</a>"</font>&gt;<font color="navy">Name of Human or Device that authored the resource</font>&lt;/name&gt;
      &lt;<b>uri</b> <a href="xml.htm#Control" class="cf">opt</a> <font color="darkgreen">type="<a href="datatypes.htm#uri">uri</a>"</font>&gt;<font color="navy">Link to the resource for the author</font>&lt;/uri&gt;
    &lt;/author>
    &lt;<b>category</b> term="Person" scheme="urn:hl7-org:sid/fhir/resource-types"/&gt; <font color="navy">Resource Type</font>
    &lt;<b>content</b> <a href="xml.htm#Control" class="cf">mand</a> type="text/xml">
      &lt;<b>[ResourceName]</b> xmlns="http://www.hl7.org/fhir">
         &lt;<b>id</b> <a href="xml.htm#Control" class="cf">mand</a> <font color="darkgreen">type="<a href="datatypes.htm#id">id</a>"</font>&gt;<font color="navy">Resource Id (normal resource content)</font>&lt;/id&gt;
         &lt;!-- Content for the resource --&gt;
      &lt;/[ResourceName]>
    &lt;/content>
    &lt;<b>summary</b> <a href="xml.htm#Control" class="cf">opt</a> type="xhtml">
         <font color="Gray">&lt;!-- Narrative from resource for a browser --&gt;</font>
    &lt;/summary>
    &lt;<b>Signature</b> xmlns="http://www.w3.org/2000/09/xmldsig#" <a href="xml.htm#Control" class="cf">opt</a>&gt;
         <font color="Gray">&lt;!-- Enveloped Digital Signature (see Atom section 5.1) --&gt;</font>
    &lt;/Signature&gt;
  &lt;/entry&gt;
&lt;/feed&gt;
</pre>
<p>Notes:</p>
<ul>
 <li>Logically, an aggregation is a set of resources that are prepared to send somewhere for consumption - a "feed". There is no implication that the feed is a standing arrangement (though this is not precluded)</li>
 <li>The title for the feed and the entry are arbitary human readable content and not to be used for any automated processing. Applications may populate these in any useful way</li> 
 <li>Every aggregation must have a unique id, which must be a valid <a href="datatypes.htm#id">id</a>. UUIDs are recommended</li>
 <li>The link elements are mandatory in the atom feed format.</li>
 <li>The type attribute on the <i>content</i> element does appear in the xml instance (it's an atom type, not a FHIR type)</li>
 <li>The entry element carries the <a href="xml.htm#metadata">three pieces of resource metadata</a>: Version Id, Last Updated, and Master Location</li>
 <li>Author is a required element by the atom element. The author of a resource is not explicit in the FHIR resource model; instead it is delegated to the infrastructure. The name is the name of a human author, or a device. The uri is a link to the resource for the author</li>
 <li>In a RESTful implementation, the Master Location is the URL of the resource on a system that is the master for that resource. In the absence of a known master, or a RESTful implementation, some other location may be used.</li>
 <li>An xml:base element may be specified on the content element, though one is not needed for FHIR resources.</li>
 <li>The aggregation can be signed with a single Enveloped Digital Signature as described in the Atom specification</li>
</ul>

<p>
Readers of the aggregated resources should always look through the resources in the 
atom feed when a <a href="xml.htm#Resource">resource reference</a> is encountered. 
The resource reference will have the resource type and the id of the target, like this:
</p>
<div class="example">
<pre>
  &lt;institution&gt;
    &lt;type&gt;Organization&lt;/type&gt;
    &lt;id&gt;1145c09c-73d0-4297-9835-620e4afa9deb&lt;/id&gt;
  &lt;/institution&gt;
</pre>
</div>
<p>
A reader trying to find this institution should always look through the entries in 
the atom feed prior to looking anywhere else for the institution. If that 
organization is in the feed, it would look like this:
</p>
<div class="example">
<pre>
   .. feed ..
    &lt;content type="text/xml">
      &lt;Organization xmlns="http://www.hl7.org/fhir">
         &lt;id&gt;1145c09c-73d0-4297-9835-620e4afa9deb&lt;/id&gt;
         &lt;!-- other Content for the resource --&gt;
      &lt;/Organization>
    &lt;/content>
    ... feed ...
</pre>
</div>
<p>
It would also be possible to locate the resouce by the url (todo: explanation of this method).
</p>
<a name="Ids"></a>
<h3>XML Ids in resources</h3>
<p>
FHIR resources make use of XML id attributes as targets for pointers elsewhere in the document. XML id attributes must be unique 
in the context of a single XML document, and the atom feed is a single XML document. it can be difficult and time consuming - or
impossible in the presence of a digital signature - to fix the id attributes so they are unique when aggregating resources.
For this reason, it is highly recommended that all XML id attributes are prefixed with the type and master id of the resource, like
this: [Type]_[master id]_id (e.g. Person_23442_1). 
</p>
<a name="endpoint"></a>
<h3>RESTful support for Aggregations</h3>
<p>
The standard RESTful endpoints (such as [baseurl]/people/#{id}.xml for a Person resource, or [baseurl]/documents/#{id}.xml) handle
the individual resources, and not aggregations (though they may serve up aggregations for the history and update operations). 
There is a special end-point for aggregations at the relative url "/assemblies", which supports the following operations:
</p>
<table class="list"> 
  <tr><td><b>Instance</b></td><td></td></tr>
  <tr><td>read</td><td>Retrieve an aggregation</td></tr>
  <tr><td>vread</td><td>Not supported - aggregations have no version history</td></tr>
  <tr><td>update</td><td>Not supported - aggregations never change</td></tr>
  <tr><td>delete</td><td>Delete an aggregation</td></tr>
  <tr><td>validate</td><td>Check that the content would be acceptable as an update</td></tr>
  <tr><td>history</td><td>Not supported - aggregations never change</td></tr>
  <tr><td>transaction</td><td>Not supported</td></tr>
  <tr><td colspan="2"><b>Manager</b></td></tr>
  <tr><td>search</td><td>Search the aggregations based on some filter criteria. Supported search parameters<br/>
              <ul>
	        <li>Document.id - an id of a document. There should only be one aggregation for each document (optional, for systems that support documents)</li>
	        <li>Message.id - an id of a message. There is usually only one aggregation per message. (optional, for systems that archive messages and make them available in this fashion)</li>
		<li>[ResourceType].id - an id of a resource that may be brought into an aggregation. Multiple aggregations should be expected in the response. (also optional)</li>
	      </ul>
	      </td></tr>
  <tr><td>create</td><td>Create an aggregation (i.e. post to the server. The ID is assigned by the client)</td></tr>
  <tr><td>updates</td><td>Get a list of updates to resources of this type, optionally with some filter criteria</td></tr>
  <tr><td>transaction</td><td>Not supported</td></tr>
  <tr><td>conformance</td><td>Not supported (no conformance statement for aggregations directly)</td></tr>
  <tr><td>schema</td><td>Not supported (no schema for FHIR atom directly)</td></tr>
</table>
<p>
For all these resources, the id (as used in the <a href="http.htm">RESTful transactions</a>) is the 
unique id of the aggregation. Note that creating an aggregation does not mean that any apparent 
implied transactions in the resources found in the aggregation should be applied to the server resources and/or 
executed by any system - specific transaction are required, either using the RESTful or messaging frameworks, 
or a SOA implementation.
</p>

<h2>Useful Resources</h2>
<p>
General Resources:
<p>
<ul>
 <li><a href="fhir-all.xsd.zip">All schemas as a .zip</a> (includes base schemas, resource schemas, and metadata schemas)</li>
 <li><a href="fhir.dict.xml">Single combined definitions, including data types</a> (or as <a href="csv.zip">CSV source</a>)</li>
 <li>The UML definitions as an <a href="fhir.xmi">XMI file</a> (or the <a href="fhir.eap">Enterprise Architect source</a>)</li>
</ul>
<p>
Resource specific resources:
</p>
<table class="codes">
  <%resimplall%>
</table>
<p>
Note: the JSON examples are simply the XML examples auto-converted to JSON by the <a href="http://www.json.org/java/index.html">json.org code</a>. TODO: Add note about why JSON is included.
</p>
<p>
All of these resources except the JSON format are normative (i.e. Ballot comments may be made against these resources with regard to their 
correctness, other comments may be ruled out of scope). The reference implementations below are informative, and not subject to ballot.
</p>

<h3>Reference Implementations</h3>
<p>
Reference implementations are provided for implementer interest. Other implementations can be used, including code generated from the schemas.
</p>
<p>
<b><a href="java.zip">Java</a></b>: Resource Definitions + parser (+ more todo). The java reference implementation depends on XmlPull and the Apache Commons Codec library.
</p>
<p>
<b><a href="csharp.zip">C#</a></b>: Resource definitions (+ more todo) 
</p>

<h2>Default Values</h2>
<p>
This is a list of the all the default values defined in the FHIR specification:
</p>
<ul>
  <li>In the RESTful conformance  declaration, support for a transaction is declared on an element of type boolean. If no element is present, the transaction is not supported.</li>
</ul>

<%footer%>
<%/maindiv%>    
</body>
</html>