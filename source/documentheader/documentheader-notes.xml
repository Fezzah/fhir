<div xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.w3.org/1999/xhtml ../../schema/xhtml1-strict.xsd" xmlns="http://www.w3.org/1999/xhtml">

<p>
Notes:
</p>
<ul>
<li>The author and the attester are often the same person, but this may not be the case in some clinical workflows</li>
<li>The attester attests to the collated narrative portions of the resources</li>
<li>The author, subject, enterer and informant features are inherited in contained sections and need not be repeated. Specifying any of these in a section replaces the inherited value</li>
<li>The custodian is responsible for the maintenance of the document. Principally, they are responsible for the policy regarding persistence of the documents. They need not actually retain a copy of the document, but they should do so.</li>
</ul>  

<h2>Presenting a Document</h2>
<p>
The human display of the Document is the collated narrative portions of following resources (in order):
</p>
<ol>
 <li>The Document itself</li>
 <li>The Subject resource</li>
 <li>Resources referenced in the <i>section.content</i></li>
</ol>
<p>
The document narrative should summarise the important parts of the document header that are required 
to establish clinical context for the document (other than the subject, which is displayed in its own 
right). To actually build the combined narrative, simply append all the narrative &lt;div&gt; fragments. 
</p>

<a name="css"></a>
<h3>Styling Documents</h3>
<p>
In addition to the <a href="xml.htm#css">basic style rules</a>, which must be followed, a document can 
contain a style sheet that contains additional styles that apply to the collated narrative. Unless
otherwise agreed in local trading partner agreements, applications displaying the collated narrative 
should use the style sheet provided in the document. Parties entering into such a trading agreement
should consider the implications it will have on their long term scope for document exchange 
very carefully. 
</p>

<h2>Document Handling Obligations</h2>
<p>
The authors and users of Clinical Documents, whether human or software, have 
obligations that they must satisfy. 
</p>

<h3>Author Obligation</h3>
<p>
A document author is an application that creates a document resource. The author may create 
new content resources and/or assemble already existing content resources while doing so. A document author 
has the following responsibilities:
</p>
<ul>
 <li>Build a valid document header that that conforms to the Document rules explained here and that only links to other valid resources</li>
 <li>Ensure that the content of the document and other resources conforms to any declared <a href="profile.htm">Profiles</a>.</li>
 <li>Ensure that the presentation of the document is properly attested according to the information supplied in the <i>attesters</i>.</li>
</ul>

<h3>User Obligations</h3>
<p>
A document user is an application that receives or presents documents, or extracts data from them, or makes decisions because of them. 
The documents may be received directly from a document author or accessed via a document management system. 
The document user is responsible for ensuring that received documents are processed and/or rendered in accordance 
to this specification. A document recipient has the following obligations:
</p>
<ul>
 <li>When storing/transmitting a document, any method may be used as long as the bundled document can be (re-)assembled with sufficient integrity to validate a digital signature (i.e. it is legitimate to unbundle the resources and store them on a FHIR RESTful server, but this is not required)</li>
 <li>When presenting the narrative of the document, the rules described above must be followed</li>
 <li>A user is allowed to extract resources or data from the document for other use, but such data is no longer considered to be attested by the document author</li>
 <li>Wherever the data (or information derived from it) is displayed to a user, there should always be a way for the user to access a presentation of the original document</li>
 <li>It must correctly determine when a document has been superseded (according the statements made in the 
    <i>setId</i>, <i>version</i> or <i>replaces</i> elements of received documents or those in the 
    source document management system) and either withdraw data extracted from superseded documents, 
    or warn users when they view the document</li>
</ul>

<a name="rest"></a>
<h2>Implementation Notes</h2>
<ul>
 <li>Documents may be signed using digital signatures following the rules laid out in 
     the <a href="http://tools.ietf.org/html/rfc4287" target="_blank">Atom specification</a>. 
     The signature SHOULD be provided by a listed attester of the document and the signature 
     SHOULD contain a <a href="http://www.w3.org/TR/xmldsig-core/#sec-KeyInfo" target="_blank">KeyInfo 
     element</a> that contains a KeyName element whose value is a URI that matches the Atom <i>link</i> 
     element value for the attester.</li>
</ul>

<a name="endpoint"></a>
<h2>RESTful support for Document Bundles</h2>
<p>
The standard RESTful endpoints (such as [baseurl]/person/@{id} for a Person resource or [baseurl]/document/@{id} for the Document resource) handle
the individual resources and not bundles (though, per the RESTful spec, they serve up atom feeds for 
the <a href="http.htm#history">history</a>, <a href="http.htm#search">search</a> and <a href="http.htm#update">update</a> operations). 
The <a href="documentheader.htm">Document</a> framework defines an additional end-point for handling document bundles at 
[baseurl]/document/@{id}). In this context, the id is the id of the Document Header resource. The end-point supports the following operations:
</p>
<table class="list"> 
  <tr><td><b>Instance</b></td><td></td></tr>
  <tr><td>read</td><td>Retrieve a document bundle</td></tr>
  <tr><td>vread</td><td>Retrieve a particular version of a document</td></tr>
  <tr><td>update</td><td>Post a document to the server.</td></tr>
  <tr><td>delete</td><td>Delete a bundle. </td></tr>
  <tr><td>validate</td><td>Check that the content would be acceptable as a submission</td></tr>
  <tr><td>history</td><td>Returns a history for the document.</td></tr>
  <tr><td colspan="2"><b>Manager</b></td></tr>
  <tr><td>updates</td><td>Get a list of updates to resources of this type, optionally with some filter criteria</td></tr>
  <tr><td>search</td><td>Search the document bundles based on some filter criteria. Supported search parameters<br/>
              <ul>
	        <li>atom.id - an id of a document (i.e. the feed.id in the atom)</li>
		<li>other parameters as for the document resource apply</li>
	      </ul>
	      </td></tr>
  <tr><td>create</td><td>Not supported - document ids are always provided by the author, and the document must be provided as an update</td></tr>
</table>
<p>
Note that the history, updates and search methods all return atom feeds that contain bundles - that is, atom feeds that contain entries where
the content type is another atom feed. Atom feeds are only ever nested two levels deep (i.e. one atom feed containing a series of atom feeds
that are bundles that contain resources).
</p>



</div>
