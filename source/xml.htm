<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Resource Format - FHIR v<%version%></title>
    <link rel="Stylesheet" href="fhir.css" type="text/css"/>
    <link rel="Stylesheet" href="fhir-print.css" type="text/css" media="print" />
</head>

<body>
<%sidebar%>


<%maindiv%>

<%xmlheader%>

<!--
<div class="itoc">
<p>On This Page:</p>
<p class="link"><a href="#">Resource Format</a></p>
<p class="link"><a href="#">Resource Content</a></p>
<p class="link"><a href="#">Narrative</a></p>
<p class="link"><a href="#idref">Internal Refernces</a></p>
<p class="link"><a href="#resource">Resource References</a></p>
<p class="link"><a href="#resource">Versioning</a></p>
</div>
-->

<%onthispage Resource Format#|Resource Content#metadata|Narrative#narrative|Internal References#idref|Resource References#resource|Versioning#version%>

<h1>Resource Format</h1>
<p>
This page documents how the content of the resources are described and controlled. 
</p>

<h2>Resource Description</h2>
<p>
The resources are described in two different ways: a UML diagram that summarises the content, and 
an pseudo-XML syntax that provides a visual sense of what the end resource instances will look like. 
The syntax uses the following notation:
</p>

<pre class="spec">
 &lt;<b>name</b> xmlns="http://hl7.org/fhir" [xml:lang]&gt; 
   &lt;<u><b title="Formal Definition (must tbe supported or understood)">nameA</b></u>&gt;<font color="Gray">&lt;!-- </font><font color="brown">1..1</font> <font color="Darkgreen">type</font> <font color="Navy">description of content</font> <font color="Gray"> --&gt;</font>&lt;nameA&gt;
   &lt;<b title="Formal Definition">nameB</b>&gt;<font color="Gray">&lt;!-- </font><font color="deeppink" title="Condition">0..1</font> <font color="darkgreen">type</font> <font color="Navy">description</font> <font color="Gray"> --&gt;</font>&lt;/nameB&gt;
   &lt;<b>nameC</b>&gt; <font color="Brown"><font color="Gray">&lt;!-- </font> <b>1..*</b> --&gt;</font>
     &lt;<b>nameD</b> &gt;<font color="Gray">&lt;!-- </font><font color="brown">1..1</font> <font color="darkgreen">type</font>&gt;<font color="navy">Relevant records</font> <font color="Gray"> --&gt;</font>&lt;/nameD&gt;
   &lt;/nameC&gt;
 &lt;name&gt;
</pre>
<p>
Notes:
</p>
<ul>
 <li>To build a valid instance of a resource, simply replace the contents of the elements with valid content as described by the cardinality, type rules and content description found in the comment in each element.</li>
 <li>Elements are assigned a cardinality that specifies how many times the element may or must appear. If the cardinality is shown in 
    <font color="deeppink">Pink</font> then there is an additional condition that impacts on the allowed cardinality. This is available as a mouse-over text, or in the formal definitions.</li>
 <li>The elements are assigned one or more types. All of the types are defined in <a href="datatypes.htm">the data types</a> except for "Resource" and "Narrative" that are documented below. The type names are hyperlinked.</li>
 <li>Each element name in the pseudo-syntax is also a hyperlink to the formal definition of the element in the data dictionary that underlies the exchange formats. </li>
 <li>If the element name is underlined, then applications are required to support and/or understand it (see below).</li>
 <li>The XML character set is always Unicode. Specifying the character encoding is optional but recommended (default value is UTF-8, as for XML). Any encoding that is round trip compatible with Unicode is allowed.</li>
 <li>FHIR elements are always in the namespace <a href="http://hl7.org/fhir">http://hl7.org/fhir</a>.  This is usually specified as the default namespace on the root element. 
   The only other namespaces that occur in FHIR resources are where some external content model is explicitly introduced into the resource content model. For example, XHTML is found in every resource - see below.</li>
 <li>Any of the XML elements may have an id attribute to serve as <a href="#idref">the target of an internal reference</a>. The id attribute is not shown in this format.</li>
 <li>FHIR elements are never empty. If an element is present in the resource, it must have either text or child elements as defined for its type, or an id attribute that is the <a href="#idref">link target</a> of <a href="#narrative">narrative</a> or <a href="extensibility.htm">extensions</a></li>
 <li>The xml:lang attribute may appear on the root element, where it specifies the base language of the resource. It may also appear on <a href="datatypes.htm#Attachment">attachments</a> and in the XHTML content, but nowhere else</li>
 <li>In addition to this descriptive syntax, other definitional forms are available, including W3C schema and Schematron. The formats Relax NG schema, RDF and eCore are planned.</li>
</ul>
<p>
When represented as XML, resources may be validated by schema and schemas are provided, but 
operational systems are not required to do so (though the XML must always be 
valid against this specification and the schema and Schematron). In addition to 
the simple XML description, W3C Schema, UML models, and other definitional models 
are provided that may be a useful aid for system implementation. Resources may 
also be represented using <a href="json.htm">JSON</a>.
</p>
<p>
The UML diagrams represent the same content as a series of classes. The root element
class is labeled with an "R" for resource, or a "D" for a data type . All the other 
classes have "E" since they represent elements that appear the instance. 
</p>
<pre>
  todo: insert diagram
</pre>
<p>
Where an element can have a choice of data types, these are represented in the 
choice using the same syntax as the xml syntax. Due to way UML works, the actual 
order of the elements cannot be determined from the diagram. 
</p>

<pre class="spec">
&lt;<a href="#ResourceDefn" title="A Resource Definition for FHIR" class="dict"><b>[Name]</b></a> xmlns="http://hl7.org/fhir"&gt;
 &lt;<a href="extensibility.htm" title="See Extensions" class="dict"><b>extension</b></a>&gt;<font color="Gray">&lt;!-- <font color="brown"><b>0..*</b></font> </font> <font color="darkgreen"><a href="extensibility.htm">Extension</a></font>   <a href="extensibility.htm"><font color="navy">See Extensions</font></a> <font color="Gray"> --&gt;</font>&lt;/extension&gt;
 &lt;<a href="#inline" title="See Contained Resources" class="dict"><b>inline</b></a>&gt;<font color="Gray">&lt;!-- <font color="brown"><b>0..*</b></font> </font> <font color="darkgreen"><a href="#metadata">Resource</a></font>   <a href="extensibility.htm"><font color="navy">Contained Resource</font></a> <font color="Gray"> --&gt;</font>&lt;/inline&gt;
 <font color="Gray">&lt;!-- Defined Content for Resource --&gt;</font>
 &lt;<a href="#Narrative" title="Text summary of resource, for human interpretation" class="dict"><b>text</b></a>&gt;<font color="Gray">&lt;!--</font> <font color="brown"><b>1..1</b></font> <font color="darkgreen"><a href="#Narrative">Narrative</a></font> <font color="navy">Text summary of [x], for human interpretation</font><font color="Gray"> --&gt;</font>&lt;/text&gt;
&lt;/[Name]&gt;
</pre>
<p>
The use of the <i>extension</i> element is <a href="extensibility.htm">discussed under "Extensibility"</a>. 
The text ("Narrative") is <a href="#Narrative">discussed below</a>. 
</p>

<p>
The logical id and version id of a Resource are of type <a href="datatypes.htm#id">id</a> which is up to 36 characters long and contains:
</p>
<table class="list">
  <tr><td>A whole number in the range 0 to 2^64-1. May be represented in hexadecimal</td></tr>
  <tr><td>A uuid (guid) (in lowercase, without wrapping with the characters "{}[]" which sometimes occur)</td></tr>
  <tr><td>An <a href="http://en.wikipedia.org/wiki/Object_identifier">ISO OID</a></td></tr>
  <tr><td>Any other combination of letters, numerals, "-" and "."</td></tr>
  <tr><td></td><td></td></tr>
</table>


<hr/>


<a name="Narrative"> </a>
<a name="narrative"> </a>
<h2>Narrative</h2>
<p>
Every resource SHALL include a human readable narrative that contains a summary of the resource, 
and may be used to represent the content of the resource to a human. The narrative need 
not encode all the structured data, but is required to contain sufficient detail to make 
it "clinically safe" for a human to just read the narrative. Resources may define 
what content should be represented in the narrative to ensure clinical safety.
</p>
<p>
The narrative for a resource is allowed to contain additional information that is not in 
the structured data, including human-edited content. Such additional information must be 
in the scope of the definition of the resource. In small, closed trading partner environments,
there may be no need for a narrative text. In such cases, implementations are allowed to 
populate the narrative with text equivalent to "No human readable text provided for this resource" (other languages are allowed). 
Implementers should note that small, closed trading partner environments are very likely 
to open up during the lifetime of the resources they define.
</p>
<p>
The narrative is an xhtml fragment that also includes images if appropriate:
</p>
<%dt Narrative%>

<p>
The contents of the <i>div</i> element are an XHTML fragment containing only the basic html formatting elements described in 
chapters 7-11 (except section 4 of chapter 9) and 15 of the HTML 4.0 standard, &lt;a&gt; elements (either name or href),
images and internally contained style attributes. The XHTML content must not contain
a head, a body element, external stylesheet references, scripts, forms, base/link/xlink, frames, iframes,
and objects. The div element must have some non-whitespace content.
<!-- Todo: Formally encode these constraints in schematron -->
</p>
<div class="example">
<pre class="xml" fragment="Narrative">
  &lt;narrative&gt;
    &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;This is a simple 
          example with only plain text&lt;/div&gt;
  &lt;/narrative&gt;
   
  &lt;narrative&gt;
   &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;
     &lt;p&gt;
       This is an &lt;i&gt;example&lt;/i&gt; with some &lt;b&gt;xhtml&lt;/b&gt; formatting.
     &lt;/p&gt;
   &lt;/div&gt;
  &lt;narrative&gt;
</pre>
</div>
<p>
The image source may be a local reference within the resource:
</p>
<pre class="xml">
  &lt;img src="#a5"/&gt;
</pre>
<p>
This is an <a href="#idref">internal reference</a> to an id attribute on an element in the same resource, either in the image attachments on the text element 
directly, or an element of type "<a href="datatypes.htm#Attachment">Attachment</a>".
</p>
<div class="example">
<pre class="xml" fragment="Narrative">
  &lt;narrative&gt;
    &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;
      &lt;p&gt;
        &lt;img src=&quot;#a1&quot;/&gt;.
      &lt;/p&gt;
    &lt;/div&gt;
    &lt;image id=&quot;a1&quot;&gt;
      &lt;mimeType&gt;image/png&lt;/mimeType&gt;
      &lt;content&gt;MEKH....SD/Z&lt;/content&gt;
    &lt;/image&gt;
  &lt;/narrative&gt;
</pre>
</div>

<p>
Since the presence of images that are not part of the resource is not guaranteed, 
images that are an essential part of the narrative should always be embedded.
</p>
<p>
Note: the XHTML is contained in general XML, and there is no support for HTML entities
like <i>&amp;nbsp;</i> or <i>&amp;copy;</i> etc. Unicode characters should be used instead. Note that 
<i>&amp;#160;</i> substitutes for <i>&amp;nbsp;</i>.
</p>

<a name="css"></a>
<h3>Styling the XHTML</h3>
<p>
The XHTML fragment in the narrative may be styled using CSS in the normal fashion, using a mix of classes, ids 
and in-line style elements. Specific CSS stylesheets will be applied to the XHTML when it is extracted from
the resource to be displayed to a human to create the presentation desired in the context of use. Authors
may fix the following styling aspects of the content:
</p>
<ul>
  <li>bold, italic, underline, strikethrough</li>
  <li>font color, family, and size</li>
  <li>background color, text alignment</li>
  <li>whitespace interpretation</li>
  <li>ordered list number format (since it may be referred to in text)</li>
</ul>
<p>
These style properties are specified in-line using the style attribute. If an equivalent 
html element exists, such as "i", or "pre", it may be used instead, but note that some of these 
elements are deprecated in HTML 4 and must not be used in Narrative XHTML (including "u", and "font").
</p>
<p>
Rendering systems are required to respect any of these rendering styles when they are specified in 
the XHTML, though appropriate interpretation is allowed (e.g. a low-contrast display for dark 
room contexts may adjust colors accordingly). 
</p>
<p>
Authors are allowed to specify additional styles and style properties as specified in the CSS specification,
but these are extensions to this specification and renderers are not required to honor them. Note, however,
the additional rules around styling that apply in the context of <a href="document.htm#css">documents</a>.
</p>
<p>
Note: styles in resources can make use of the styles defined in the standard FHIR stylesheet, which
lives here: <a href="http://hl7.org/implement/standards/fhir/fhir.css">http://hl7.org/implement/standards/fhir/fhir.css</a>.
Since this stylesheet is not referred to directly, rendering systems may take their own copy if they wish. 
Authoring systems should not depend on these styles being defined for clinical content. 
</p>
<a name="idref"></a>
<a name="id"></a>
<h2>Internal References</h2>
<p>
There are 4 cases where elements inside a resource reference each other:
</p>
<ul>
 <li>Inside a <a href="datatypes.htm#CodeableConcept">CodeableConcept data type to identify the primary encoding</a></li>
 <li>An &lt;img src=""/&gt; reference in the narrative, referring to an image found in the resource</li>
 <li>Between elements in the narrative and structured data elements</li>
</ul>
<p>
These references are done using an id/idref based approach, where a source element indicates that it 
has the same content as the target element. The target element has an attribute "id" which must 
have a unique value within the resource with regard to any other id attributes. The "id" attribute is not in any namespace.
The source element reference must refer to an attribute in the same resource (or, for a CodeableConcept, inside the
same datatype). 
</p>
<div class="example">
<pre class="xml">
  &lt;example&gt;
    &lt;target id="a1"&gt;
      &lt;child&gt;content&lt;/child&gt;
    &lt;/target&gt;
    &lt;-- other stuff --&gt;
    &lt;source idref="a1"&gt;
  &lt;/example&gt;
</pre>
</div>
<p>
In a single resource, this works like xml:id/idref, but there is an important difference: the 
uniqueness and resolution scope of these id references is within the resource that contains them. If multiple
resources are combined into a single piece of XML, such as an <a href="atom.htm">atom feed</a>, duplicate 
values may occur between resources. This must be managed by applications reading the resources.
</p>
<p>
Note that all references between the xhtml elements and the data elements must be understood to 
establish a "derived from" relationship, where the derived content (whether text or data) refers 
to the source content.
</p>




<h2>XML Schema and Schematron</h2>
<p>
This specification provides schema definitions for all of the content models described here. 
The base schema is called "<a href="fhir-base.xsd">fhir-base.xsd</a>" and defines all of the 
datatypes and also the base infrastructure types described on this page. In addition, there 
is a schema for each resource and a common schema <a href="fhir-all.xsd">fhir-all.xsd</a> 
that includes all the resource schemas.  A customized atom schema <a href="fhir-atom.xsd">fhir-atom.xsd</a>
is provided for validating <a href="atom.htm">bundles</a>.
</p>
<p>
In addition to the w3c schema files, this specification also provides Schematron files that
enforce the various constraints defined for the datatypes and resources.  These are packaged
as files for each resource as well as a combined fhir-atom.sch file
that incorporates the rules for all resources.
</p>
<p>
XML that is exchanged must be valid against the w3c schema and Schematron, though there is no requirement to
validate instances against either, nor is being valid against the schema and 
Schematron sufficient 
to be a conformant instance. (This specification makes several rules that cannot be checked 
by either mechanism.) Exchanged content must not specify the schema or even the schema instance 
namespace in the resource itself. 
</p>

<!-- Todo: Relax NG, RDF, eCore -->

<a name="objects"></a>
<h2>Object Models</h2>
<p>
In addition to the schema, this specification also provides object
models defined in UML that may be of assistance in defining systems 
that work with the resources defined here.
</p>
<p>
Although the UML models provided express the same contents as the 
resource formats, because of the wide variation in how different architectures and 
tools map from UML to XML, there should be no expectation that any particular
tool will produce compatible XML from these UML diagrams. Systems are welcome
to use these object models as a basis for serialization internally or even
between trading partner systems, with any form of exchange technology (including 
JSON). Systems that use this form of exchange cannot claim to be conformant 
with this specification, but can describe themselves as using "FHIR consistent
object models".
</p>

<%footer%>
<%/maindiv%>    
</body>
</html>